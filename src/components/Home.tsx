"use client";

import React, { useEffect, useState, useCallback, useMemo, ChangeEvent, FormEvent } from 'react';

import 'leaflet/dist/leaflet.css';
import 'bootstrap/dist/css/bootstrap.min.css';
import 'bootstrap/dist/js/bootstrap.bundle.min.js';

import { MapContainer, TileLayer, GeoJSON, Popup, Marker, ImageOverlay, useMap } from 'react-leaflet';
import { Feature, FeatureCollection, GeoJsonObject, Polygon, Geometry, GeoJsonProperties } from 'geojson';

import {
  FaParking, FaTree, FaWater, FaBuilding, FaPaw, FaTractor,
  FaMapSigns, FaFlag, FaRunning, FaLayerGroup, FaInfoCircle,
  FaSearch, FaRegCommentDots, FaClipboardList
} from 'react-icons/fa';
import L from 'leaflet';
import { getGeocode, getLatLng } from "use-places-autocomplete";
import { useLoadScript } from "@react-google-maps/api";

import PlacesAutocomplete from "@/components/PlacesAutoComplete";
import { CurrentLocationControl, HomeControl } from "@/components/Controls";
import Loader from "@/components/Loader";
import { createReview, fetchReviews} from "@/api";
import { Review } from '@/types';

type Park = {
  lat: number;
  lng: number;
};

type AnimalMarker = {
  type: string;
  lat: number;
  lng: number;
  img: string;
};

const parkLocations: { [key: string]: Park } = {
  //  32.47718555566557, 0.054239605403718555
  "Queen Elizabeth Exhibit": { lat: 0.05423960, lng: 32.477185 },
  // 32.47579256765899, 0.05173127608642406 
  "Kidepo": { lat: 0.05173127, lng: 32.47579256 },
  // 32.47441022657418, 0.052482120975900895
  "Farm": { lat: 0.0524821209, lng: 32.4744102 },
  //  32.477805364307, 0.05284901808345724
  "Lake Mburo": { lat: 0.052849018083, lng: 32.477805364307 }
};

const animalMarkers: { [key: string]: AnimalMarker[] } = {
  "Queen Elizabeth Exhibit": [
    // 0.054230,32.475528
    { type: "Rhinos", lat: 0.054230, lng: 32.475528, img: "/Rhino.png" },
    // 0.052706,32.476667
    { type: "Crocodiles", lat:  0.052706, lng: 32.476667, img: "/crocodile.png" },
     // 0.054363,32.477856
    { type: "Zebras", lat: 0.054363, lng: 32.477856, img: "/zebra.png" },
    // 0.054126,32.477681
    { type: "Elephants", lat:  0.054126, lng: 32.477681, img: "/Elephant.png" },
    { type: "Lions", lat: 0.05314444912552913, lng: 32.47597920052584, img: "/Lion.png" }
  ],
  "Kidepo": [
    // 0.051900,32.474714
    { type: "Giraffes", lat: 0.051900, lng: 32.474714, img: "/Giraffe.png" },
    // 0.051085,32.476368
    { type: "Monkeys", lat:  0.051085, lng: 32.476368, img: "/monkey.png" }
  ],
  "Lake Mburo": [
    // 0.052108,32.476682
    { type: "Snakes", lat: 0.052108, lng: 32.476682, img: "/snake.png" },
    // 0.052458,32.477379
    { type: "Zebra", lat: 0.052458, lng: 32.477379, img: "/zebra.png" },
    // 0.052389,32.477588
    { type: "Crocodiles", lat:  0.052706, lng: 32.476667, img: "/crocodile.png" },
  ]
};


const geojsonData: FeatureCollection = {
    "type": "FeatureCollection",
    "features": [
      {
        "type": "Feature",
        "id": 0,
        "geometry": {
          "type": "Polygon",
          "coordinates": [
            [
              [
                32.47536860209173,
                0.049739325643818305
              ],
              [
                32.47573084028196,
                0.04983213425175927
              ],
              [
                32.476008548849975,
                0.04993937299999765
              ],
              [
                32.47622729230439,
                0.04997384363893234
              ],
              [
                32.476459941480954,
                0.04993681235621675
              ],
              [
                32.476620433239205,
                0.04988295600840472
              ],
              [
                32.476672387957265,
                0.050012145972906465
              ],
              [
                32.47673705915667,
                0.05012129796643468
              ],
              [
                32.476813144698625,
                0.05002555166975109
              ],
              [
                32.4769217164359,
                0.05001962602113348
              ],
              [
                32.47702701010766,
                0.05003376064867117
              ],
              [
                32.47714826932589,
                0.0501486579180981
              ],
              [
                32.47722672990787,
                0.05038204165417279
              ],
              [
                32.47749421187928,
                0.050834448006655604
              ],
              [
                32.477501344279936,
                0.050902667744616
              ],
              [
                32.47765113500237,
                0.05105347036751166
              ],
              [
                32.47798281338191,
                0.05152023934599017
              ],
              [
                32.478236030590615,
                0.0518290252844931
              ],
              [
                32.478433968295946,
                0.05203248915918964
              ],
              [
                32.47865152163664,
                0.05223355953661965
              ],
              [
                32.47900103430852,
                0.05246694562590475
              ],
              [
                32.479357680332896,
                0.05265365516230815
              ],
              [
                32.47981062152629,
                0.05280446042188563
              ],
              [
                32.479571662196044,
                0.053454340836808695
              ],
              [
                32.47894380297296,
                0.05320919203329831
              ],
              [
                32.47898376367436,
                0.05305767229986628
              ],
              [
                32.47899389735945,
                0.05294807394936409
              ],
              [
                32.478794175865474,
                0.05281163287145358
              ],
              [
                32.47859088748249,
                0.052725458912814674
              ],
              [
                32.47821284307158,
                0.05248848207264249
              ],
              [
                32.4779917225972,
                0.05236999339328734
              ],
              [
                32.477938225947106,
                0.05231254478930367
              ],
              [
                32.477852631348505,
                0.052215600311274445
              ],
              [
                32.47771353962693,
                0.052118655389241514
              ],
              [
                32.47752808441427,
                0.05193912836666816
              ],
              [
                32.47716430688371,
                0.051587255429456275
              ],
              [
                32.47706087965117,
                0.05152262540803638
              ],
              [
                32.47695031868087,
                0.051554939076731296
              ],
              [
                32.47684688998598,
                0.05166983451217641
              ],
              [
                32.47671849605881,
                0.05177395820913836
              ],
              [
                32.476647166043804,
                0.05183858677798612
              ],
              [
                32.476568703552424,
                0.05184576714294751
              ],
              [
                32.476487368177914,
                0.05183968254815949
              ],
              [
                32.476555135965015,
                0.05125443015785684
              ],
              [
                32.47625555519573,
                0.05087742427348724
              ],
              [
                32.476209192219955,
                0.0507302130369305
              ],
              [
                32.47603443638463,
                0.05055786719872189
              ],
              [
                32.47576695223513,
                0.050385520618593034
              ],
              [
                32.47564925983857,
                0.05023112780387059
              ],
              [
                32.4756265738656,
                0.05013548046661322
              ],
              [
                32.47562842102644,
                0.050087358735755906
              ],
              [
                32.47566705804672,
                0.050059233397780574
              ],
              [
                32.47536860209173,
                0.049739325643818305
              ]
            ]
          ]
        },
        "properties": {
          "FID": 0,
          "Id": 0,
          "name": "Beach",
          "type": "beach"
        }
      },
      {
        "type": "Feature",
        "id": 57,
        "geometry": {
          "type": "Polygon",
          "coordinates": [
            [
              [
                32.472723719934656,
                0.051249704376426154
              ],
              [
                32.47270013675754,
                0.05118567267652433
              ],
              [
                32.47282068378505,
                0.05115192291063138
              ],
              [
                32.47284992813998,
                0.05123953151790797
              ],
              [
                32.47278863630984,
                0.0512624920660372
              ],
              [
                32.47277717219362,
                0.05122947749630121
              ],
              [
                32.472723719934656,
                0.051249704376426154
              ]
            ]
          ]
        },
        "properties": {
          "FID": 57,
          "Id": 0,
          "name": "Buildings",
          "type": "buildings"
        }
      },
      {
        "type": "Feature",
        "id": 0,
        "geometry": {
          "type": "Polygon",
          "coordinates": [
            [
              [
                32.475603917758185,
                0.052929069585584854
              ],
              [
                32.475858803113795,
                0.05276630203516384
              ],
              [
                32.47591357832085,
                0.05277247098991572
              ],
              [
                32.47597920052584,
                0.052881623007573764
              ],
              [
                32.47604910272779,
                0.052963487198292324
              ],
              [
                32.476067647535295,
                0.05306545780146493
              ],
              [
                32.47608333935573,
                0.05314444912552913
              ],
              [
                32.47609617825046,
                0.0531932801528736
              ],
              [
                32.476167506991274,
                0.05328088917464827
              ],
              [
                32.47626166112957,
                0.05337280700452345
              ],
              [
                32.476371507791,
                0.05346041636119057
              ],
              [
                32.47647850126191,
                0.05354946189973948
              ],
              [
                32.476585495002034,
                0.05360691096249855
              ],
              [
                32.4768166018449,
                0.05368877655753611
              ],
              [
                32.477136157119,
                0.0537878773648702
              ],
              [
                32.47728737517991,
                0.053842454410934604
              ],
              [
                32.47767516887138,
                0.05396022647052306
              ],
              [
                32.477835897552986,
                0.054013846137114095
              ],
              [
                32.47785396771768,
                0.05401097388568549
              ],
              [
                32.47796999833693,
                0.05385873727639481
              ],
              [
                32.478112658862585,
                0.053679691750154995
              ],
              [
                32.478307625143096,
                0.053801292027783824
              ],
              [
                32.47853017210611,
                0.053930552305042206
              ],
              [
                32.47875557223944,
                0.05406172755405369
              ],
              [
                32.478869698788415,
                0.05414024103107575
              ],
              [
                32.478940076815924,
                0.05419003004934077
              ],
              [
                32.478960999665176,
                0.054245563456550024
              ],
              [
                32.47901806250606,
                0.05433556607685271
              ],
              [
                32.47904849584145,
                0.05440450413982902
              ],
              [
                32.47892105227906,
                0.054578762464167076
              ],
              [
                32.47880692363876,
                0.05474344620378968
              ],
              [
                32.47879170637842,
                0.05477791496860556
              ],
              [
                32.478806922794845,
                0.05484110808155231
              ],
              [
                32.478767906855495,
                0.05514764954183899
              ],
              [
                32.47881353990563,
                0.055163446856839125
              ],
              [
                32.47879574295248,
                0.05540308267276701
              ],
              [
                32.47879574134984,
                0.05558619869322656
              ],
              [
                32.478763642081624,
                0.05569870106058614
              ],
              [
                32.47875650809884,
                0.05581599099639861
              ],
              [
                32.47860314800054,
                0.05600269615280263
              ],
              [
                32.47830665683911,
                0.05579474313050491
              ],
              [
                32.47829524445505,
                0.05575644425616471
              ],
              [
                32.47841698582882,
                0.055107281136110936
              ],
              [
                32.478428399348935,
                0.05501536418079507
              ],
              [
                32.47841318336713,
                0.05490238266596772
              ],
              [
                32.478401771474765,
                0.05480663563289934
              ],
              [
                32.4781868328217,
                0.05469939718710022
              ],
              [
                32.477992816884424,
                0.054663011656329696
              ],
              [
                32.47780640936719,
                0.054634285947735825
              ],
              [
                32.4775534275083,
                0.05462279410338431
              ],
              [
                32.47734990087576,
                0.054599813061774985
              ],
              [
                32.47717680796867,
                0.05459981154668914
              ],
              [
                32.47692572794081,
                0.054624703544696764
              ],
              [
                32.47669747309371,
                0.05468023475005062
              ],
              [
                32.476497750065064,
                0.054733851263067596
              ],
              [
                32.47630373353368,
                0.05477214831810879
              ],
              [
                32.47613254290769,
                0.05475682730826287
              ],
              [
                32.475948037848994,
                0.05469554767194956
              ],
              [
                32.47578826034779,
                0.05463426825592555
              ],
              [
                32.47560565753424,
                0.054559584077673494
              ],
              [
                32.475356480832254,
                0.05445234537842631
              ],
              [
                32.47524045202119,
                0.05439872610658882
              ],
              [
                32.47515105293043,
                0.05433936225644976
              ],
              [
                32.475099696257196,
                0.05427616886504046
              ],
              [
                32.47508448001304,
                0.054193826413698444
              ],
              [
                32.47512062146276,
                0.054055951218268866
              ],
              [
                32.475246163527544,
                0.053799350660457754
              ],
              [
                32.47532985798239,
                0.05365764599416983
              ],
              [
                32.475445889096164,
                0.05344125903022667
              ],
              [
                32.475571431139876,
                0.053184658445795965
              ],
              [
                32.475613278684726,
                0.053075507349076394
              ],
              [
                32.47561518127147,
                0.05301997416903088
              ],
              [
                32.475603917758185,
                0.052929069585584854
              ]
            ]
          ]
        },
        "properties": {
          "FID": 0,
          "Id": 0,
          "name": "Queen Elizabeth Exhibit",
          "type": "exhibit1"
        }
      },
      {
        "type": "Feature",
        "id": 0,
        "geometry": {
          "type": "Polygon",
          "coordinates": [
            [
              [
                32.4751897328699,
                0.049821630872893416
              ],
              [
                32.47536860209173,
                0.049739325643818305
              ],
              [
                32.47566705804672,
                0.050059233397780574
              ],
              [
                32.47562842102644,
                0.050087358735755906
              ],
              [
                32.4756265738656,
                0.05013548046661322
              ],
              [
                32.47536265388481,
                0.050253965109988565
              ],
              [
                32.47474208518589,
                0.050548381735229034
              ],
              [
                32.47446033249087,
                0.05071354279522604
              ],
              [
                32.47438900065157,
                0.05100796384121486
              ],
              [
                32.47472875248778,
                0.052725186863075035
              ],
              [
                32.47484687585059,
                0.05274714406822051
              ],
              [
                32.475105563791665,
                0.05277778526758887
              ],
              [
                32.47519306106413,
                0.05280268020060001
              ],
              [
                32.47529957986697,
                0.05278736160413572
              ],
              [
                32.47539278401333,
                0.052750978578820655
              ],
              [
                32.47557538754214,
                0.05274140543936067
              ],
              [
                32.47572755684643,
                0.05277013079748547
              ],
              [
                32.475858803113795,
                0.05276630203516384
              ],
              [
                32.475603917758185,
                0.052929069585584854
              ],
              [
                32.475476475911194,
                0.052911834060802174
              ],
              [
                32.47537566373598,
                0.052894598763127854
              ],
              [
                32.475153115597166,
                0.05291757612066228
              ],
              [
                32.47500665214976,
                0.0529501288124313
              ],
              [
                32.474854482041835,
                0.05301906526739456
              ],
              [
                32.474717528630165,
                0.05311864084913049
              ],
              [
                32.47459056116955,
                0.05323886193155158
              ],
              [
                32.4744307815556,
                0.053429875569967485
              ],
              [
                32.47423105734389,
                0.05363237847700052
              ],
              [
                32.47404845274152,
                0.05377168858747771
              ],
              [
                32.473828757230805,
                0.05386360366958472
              ],
              [
                32.47371890983506,
                0.05386791132347004
              ],
              [
                32.47363331481213,
                0.053830569304028984
              ],
              [
                32.47342584152784,
                0.05379418369541006
              ],
              [
                32.473172860014124,
                0.053763542504417935
              ],
              [
                32.47290085780156,
                0.05367736797776309
              ],
              [
                32.47270493969823,
                0.053665876656073225
              ],
              [
                32.472497609349915,
                0.05360076700391834
              ],
              [
                32.472043003306446,
                0.05357395394645617
              ],
              [
                32.47188061051187,
                0.0535100415269945
              ],
              [
                32.47191746677578,
                0.05319048679151877
              ],
              [
                32.47266180670199,
                0.051116107891764476
              ],
              [
                32.47319202522487,
                0.050745093218335896
              ],
              [
                32.4751897328699,
                0.049821630872893416
              ]
            ]
          ]
        },
        "properties": {
          "FID": 0,
          "Id": 0,
          "name": "Farm",
          "type": "farm"
        }
      },
      {
        "type": "Feature",
        "id": 0,
        "geometry": {
          "type": "Polygon",
          "coordinates": [
            [
              [
                32.478603148000566,
                0.05600269615285318
              ],
              [
                32.47875650809884,
                0.05581599099639861
              ],
              [
                32.478763642081624,
                0.05569870106058614
              ],
              [
                32.47879574134984,
                0.05558619869322656
              ],
              [
                32.47879574295248,
                0.05540308267276701
              ],
              [
                32.4788164309391,
                0.055124519104856703
              ],
              [
                32.47882651744231,
                0.0549744677819681
              ],
              [
                32.478859211120465,
                0.05486076857821153
              ],
              [
                32.478841379440595,
                0.054779981941617435
              ],
              [
                32.47895729139656,
                0.05460644162518686
              ],
              [
                32.479096980393145,
                0.05437006757720686
              ],
              [
                32.47917128299645,
                0.05425038454175763
              ],
              [
                32.479168311572366,
                0.05417558221558423
              ],
              [
                32.47912373174784,
                0.05404392978194671
              ],
              [
                32.479434152541074,
                0.054196676770315665
              ],
              [
                32.47954471206903,
                0.05434029815226822
              ],
              [
                32.47976206513064,
                0.054442215593403405
              ],
              [
                32.47958867609349,
                0.054654859183229584
              ],
              [
                32.47928433275264,
                0.05512401656473158
              ],
              [
                32.479018032361544,
                0.055528545050860266
              ],
              [
                32.47865937688667,
                0.056036941073389
              ],
              [
                32.478603148000566,
                0.05600269615285318
              ]
            ]
          ]
        },
        "properties": {
          "FID": 0,
          "Id": 0,
          "name": "Forest",
          "type": "forest"
        }
      },
      {
        "type": "Feature",
        "id": 0,
        "geometry": {
          "type": "Polygon",
          "coordinates": [
            [
              [
                32.475858803113795,
                0.05276630203516384
              ],
              [
                32.47572755684643,
                0.05277013079748547
              ],
              [
                32.47557538754214,
                0.05274140543936067
              ],
              [
                32.47539278401333,
                0.052750978578820655
              ],
              [
                32.47529957986697,
                0.05278736160413572
              ],
              [
                32.47519306106413,
                0.05280268020060001
              ],
              [
                32.475105563791665,
                0.05277778526758887
              ],
              [
                32.47472875248778,
                0.052725186863075035
              ],
              [
                32.47438900065157,
                0.05100796384121486
              ],
              [
                32.47446033249087,
                0.05071354279522604
              ],
              [
                32.47474208518589,
                0.050548381735229034
              ],
              [
                32.47536265388481,
                0.050253965109988565
              ],
              [
                32.4756265738656,
                0.05013548046661322
              ],
              [
                32.475636416265004,
                0.05017697744270272
              ],
              [
                32.47564925983857,
                0.05023112780387059
              ],
              [
                32.47576695223513,
                0.050385520618593034
              ],
              [
                32.47603443638463,
                0.05055786719872189
              ],
              [
                32.476209192219955,
                0.0507302130369305
              ],
              [
                32.47625555519573,
                0.05087742427348724
              ],
              [
                32.476555135965015,
                0.05125443015785684
              ],
              [
                32.476487368177914,
                0.05183968254815949
              ],
              [
                32.47648346876509,
                0.05186467549256004
              ],
              [
                32.47646349626605,
                0.051894356866203445
              ],
              [
                32.47640643242841,
                0.051924995399446776
              ],
              [
                32.47635222196044,
                0.051932535015937094
              ],
              [
                32.47625414348112,
                0.05198639182909462
              ],
              [
                32.47619767381626,
                0.05204623316951345
              ],
              [
                32.476203617692676,
                0.05207615412517267
              ],
              [
                32.476227393543375,
                0.052153948679937
              ],
              [
                32.47623928097314,
                0.052252687769853576
              ],
              [
                32.47614120241786,
                0.05231552084850769
              ],
              [
                32.47601043108645,
                0.05239032201193612
              ],
              [
                32.475987842771836,
                0.05246811617463533
              ],
              [
                32.47592364411609,
                0.052723041740795916
              ],
              [
                32.475858803113795,
                0.05276630203516384
              ]
            ]
          ]
        },
        "properties": {
          "FID": 0,
          "Id": 0,
          "name": "Kidepo",
          "type": "kidepo"
        }
      },
      {
        "type": "Feature",
        "id": 3,
        "geometry": {
          "type": "Polygon",
          "coordinates": [
            [
              [
                32.47630991709681,
                0.05223769998323948
              ],
              [
                32.47628328744177,
                0.05223554545457253
              ],
              [
                32.476260462720745,
                0.052149373053043874
              ],
              [
                32.476245246334315,
                0.05208043515771394
              ],
              [
                32.476250952961344,
                0.05204788125948748
              ],
              [
                32.47633084227958,
                0.05201149810489485
              ],
              [
                32.47645828482309,
                0.05194639127517236
              ],
              [
                32.476557195417435,
                0.051900433585835716
              ],
              [
                32.47660284609813,
                0.05192341322345379
              ],
              [
                32.476665616138824,
                0.05191192411780633
              ],
              [
                32.47672648429653,
                0.051871710923906605
              ],
              [
                32.476755016499446,
                0.051821922769410396
              ],
              [
                32.476817786729825,
                0.051787454404271176
              ],
              [
                32.47685963376991,
                0.05173766635913951
              ],
              [
                32.476914795569094,
                0.051697453114755196
              ],
              [
                32.4769433277713,
                0.05164766495788582
              ],
              [
                32.47699278311763,
                0.051618941294197744
              ],
              [
                32.47706316142119,
                0.051634261382830504
              ],
              [
                32.477122126881966,
                0.05166490088334798
              ],
              [
                32.47718679846751,
                0.05172426450594271
              ],
              [
                32.477264784797526,
                0.0517951178701117
              ],
              [
                32.47736940036513,
                0.051919589730928487
              ],
              [
                32.477491134932265,
                0.05205363643034952
              ],
              [
                32.47757863165736,
                0.052149384080430794
              ],
              [
                32.47769275821935,
                0.05222598257148352
              ],
              [
                32.477768842716074,
                0.05226236703873978
              ],
              [
                32.477837318433,
                0.052335135274276155
              ],
              [
                32.477907696032105,
                0.05243662760490952
              ],
              [
                32.47798568242836,
                0.05249982123113697
              ],
              [
                32.47807508175198,
                0.05253812075360582
              ],
              [
                32.47815687250106,
                0.05258790984452009
              ],
              [
                32.478270999165325,
                0.052653018717932557
              ],
              [
                32.47841746152307,
                0.05276025651675104
              ],
              [
                32.47850749524726,
                0.05281481297285069
              ],
              [
                32.4786400086435,
                0.05287323977960979
              ],
              [
                32.4787065825801,
                0.052905794301149695
              ],
              [
                32.47885875141803,
                0.05299962758910897
              ],
              [
                32.47888033612236,
                0.05302894734092613
              ],
              [
                32.478819676596906,
                0.05325031269239117
              ],
              [
                32.47884627747699,
                0.05325770056221736
              ],
              [
                32.47877124992993,
                0.05347070178537216
              ],
              [
                32.478761738665916,
                0.05354921419356583
              ],
              [
                32.47879597579488,
                0.0536717705684185
              ],
              [
                32.47884923375115,
                0.053838370700391935
              ],
              [
                32.47886635205301,
                0.053930287910050424
              ],
              [
                32.47893102380234,
                0.05397050218262152
              ],
              [
                32.47902422740661,
                0.05400497188563058
              ],
              [
                32.479090801261364,
                0.054047101115147746
              ],
              [
                32.47903373773129,
                0.054037525928162605
              ],
              [
                32.478989989109515,
                0.05402029110090561
              ],
              [
                32.47891961072164,
                0.05401263073814096
              ],
              [
                32.478872057762146,
                0.054006885511250616
              ],
              [
                32.4788283092556,
                0.05397624611304987
              ],
              [
                32.47879026684942,
                0.05397624578484038
              ],
              [
                32.478746518180415,
                0.053964755774776905
              ],
              [
                32.47873700810024,
                0.05390347765240667
              ],
              [
                32.478723693744406,
                0.053846268742410705
              ],
              [
                32.47871228127883,
                0.0538161083587981
              ],
              [
                32.478702295415545,
                0.05378451178354449
              ],
              [
                32.47868660321569,
                0.053750042751158265
              ],
              [
                32.4786666313181,
                0.053706956457972146
              ],
              [
                32.47867233818964,
                0.05364663593666448
              ],
              [
                32.478703724278574,
                0.053515941636174826
              ],
              [
                32.478719417400725,
                0.05344125915901549
              ],
              [
                32.47872227098045,
                0.05339386444918583
              ],
              [
                32.47869659292508,
                0.05332636263913759
              ],
              [
                32.478606718419826,
                0.05324593444659375
              ],
              [
                32.47852682986535,
                0.05318704940147698
              ],
              [
                32.47846406023652,
                0.05314683515535105
              ],
              [
                32.478394157801965,
                0.053089386401457404
              ],
              [
                32.47824293974471,
                0.05303050075478688
              ],
              [
                32.478164477411006,
                0.053016138049580684
              ],
              [
                32.47807602896001,
                0.05300033905597775
              ],
              [
                32.47797616783818,
                0.052978795150288895
              ],
              [
                32.47788201301787,
                0.05296443231290519
              ],
              [
                32.47778215163472,
                0.05297448489288921
              ],
              [
                32.47768371651825,
                0.05302331498782127
              ],
              [
                32.4776152397071,
                0.05308219876247993
              ],
              [
                32.47751109790661,
                0.053169806307874844
              ],
              [
                32.47749255216528,
                0.05317842337256434
              ],
              [
                32.477374145734764,
                0.053115229398151075
              ],
              [
                32.477298537001914,
                0.05305203578992067
              ],
              [
                32.47726429920663,
                0.053008949386797136
              ],
              [
                32.477225781726005,
                0.05295580952171211
              ],
              [
                32.477148746499985,
                0.052881126274974405
              ],
              [
                32.476994675689085,
                0.052774845896806276
              ],
              [
                32.47684345803625,
                0.05267143795489136
              ],
              [
                32.47673361114099,
                0.052609680271284924
              ],
              [
                32.47666798856397,
                0.05254361435190309
              ],
              [
                32.47660236618997,
                0.05245313297300437
              ],
              [
                32.47650250615155,
                0.052303766962269814
              ],
              [
                32.47645542901393,
                0.05226498907124162
              ],
              [
                32.476398365653914,
                0.05223770072522668
              ],
              [
                32.476339875455125,
                0.052240572641618195
              ],
              [
                32.47630991709681,
                0.05223769998323948
              ]
            ]
          ]
        },
        "properties": {
          "FID": 3,
          "Id": 0,
          "name": "Lake Mburo",
          "type": "lake Mburo"
        }
      },
      {
        "type": "Feature",
        "id": 0,
        "geometry": {
          "type": "Polygon",
          "coordinates": [
            [
              [
                32.476564842606706,
                0.04954825933478584
              ],
              [
                32.481398593504956,
                0.05108503661255432
              ],
              [
                32.48133915116691,
                0.0512166882240264
              ],
              [
                32.48137719194832,
                0.05142015086301257
              ],
              [
                32.48149131826269,
                0.051537441846882755
              ],
              [
                32.48103955254566,
                0.0529975794842043
              ],
              [
                32.48071619213106,
                0.05298082103643459
              ],
              [
                32.48022639654772,
                0.0529185813773865
              ],
              [
                32.47981062152629,
                0.05280446042188563
              ],
              [
                32.479357680332896,
                0.05265365516230815
              ],
              [
                32.47900103430852,
                0.05246694562590475
              ],
              [
                32.47865152163664,
                0.05223355953661965
              ],
              [
                32.478433968295946,
                0.05203248915918964
              ],
              [
                32.478236030590615,
                0.0518290252844931
              ],
              [
                32.47798281338191,
                0.05152023934599017
              ],
              [
                32.47765113500237,
                0.05105347036751166
              ],
              [
                32.477501344279936,
                0.050902667744616
              ],
              [
                32.47749421187928,
                0.050834448006655604
              ],
              [
                32.47722672990787,
                0.05038204165417279
              ],
              [
                32.47714826932589,
                0.0501486579180981
              ],
              [
                32.47702701010766,
                0.05003376064867117
              ],
              [
                32.4769217164359,
                0.05001962602113348
              ],
              [
                32.476813144698625,
                0.05002555166975109
              ],
              [
                32.47673705915667,
                0.05012129796643468
              ],
              [
                32.476672387957265,
                0.050012145972906465
              ],
              [
                32.476620433239205,
                0.04988295600840472
              ],
              [
                32.476564842606706,
                0.04954825933478584
              ]
            ]
          ]
        },
        "properties": {
          "FID": 0,
          "Id": 0,
          "name": "Lake Victoria",
          "type": "lake Victoria"
        }
      },
      {
        "type": "Feature",
        "id": 0,
        "geometry": {
          "type": "Polygon",
          "coordinates": [
            [
              [
                32.47868812877275,
                0.05604976451225719
              ],
              [
                32.47931524199234,
                0.055149150410322895
              ],
              [
                32.47966594989132,
                0.05463750572214564
              ],
              [
                32.479802666120754,
                0.054484910205661846
              ],
              [
                32.48003151393431,
                0.054610580076441005
              ],
              [
                32.47989479780029,
                0.05475120722682975
              ],
              [
                32.47968675082185,
                0.055044430451538
              ],
              [
                32.47943412314514,
                0.0553077323407424
              ],
              [
                32.47927363000256,
                0.05550520899982933
              ],
              [
                32.47909233162569,
                0.055792448222650816
              ],
              [
                32.47890806032882,
                0.056175434342088576
              ],
              [
                32.47868812877275,
                0.05604976451225719
              ]
            ]
          ]
        },
        "properties": {
          "FID": 0,
          "Id": 0,
          "name": "Parking",
          "type": "parking"
        }
      },
      {
        "type": "Feature",
        "id": 0,
        "geometry": {
          "type": "Polygon",
          "coordinates": [
            [
              [
                32.477506480920965,
                0.0532152541394847
              ],
              [
                32.47770561033135,
                0.05306864336254956
              ],
              [
                32.47781854915548,
                0.05301478667775253
              ],
              [
                32.477958236017756,
                0.053023764137834876
              ],
              [
                32.478196000598835,
                0.05307463171219484
              ],
              [
                32.47837432390884,
                0.05312849087599914
              ],
              [
                32.47849023355317,
                0.05322423879521433
              ],
              [
                32.478588311073075,
                0.053290065648331254
              ],
              [
                32.47867152812846,
                0.053373844927279895
              ],
              [
                32.47867152764956,
                0.053430694671124386
              ],
              [
                32.47865666665367,
                0.05351148102206575
              ],
              [
                32.47863883354327,
                0.0535982515306652
              ],
              [
                32.47861505630591,
                0.0536850219878048
              ],
              [
                32.478659636285315,
                0.053798721857902757
              ],
              [
                32.47869529989621,
                0.05393336629532552
              ],
              [
                32.478713131738935,
                0.053996200376863056
              ],
              [
                32.47837729044288,
                0.05378375897045241
              ],
              [
                32.47812466638154,
                0.05363415222041489
              ],
              [
                32.4780057845609,
                0.05355336473035056
              ],
              [
                32.478044421880426,
                0.053493523231911845
              ],
              [
                32.47802956176965,
                0.05346958637291898
              ],
              [
                32.477999841118574,
                0.05347257820995982
              ],
              [
                32.4779671480511,
                0.05351745930175242
              ],
              [
                32.47792256728988,
                0.05349651427981546
              ],
              [
                32.477506480920965,
                0.0532152541394847
              ]
            ]
          ]
        },
        "properties": {
          "FID": 0,
          "Id": 0,
          "name": "Play Area",
          "type": "play area"
        }
      },
      {
        "type": "Feature",
        "id": 219,
        "geometry": {
          "type": "Polygon",
          "coordinates": [
            [
              [
                31.7418309642297,
                -0.8140600737350827,
                0
              ],
              [
                31.741857444127593,
                -0.7236090594712795,
                0
              ],
              [
                31.65200625760613,
                -0.723583076498295,
                0
              ],
              [
                31.651977887975914,
                -0.8140308424984705,
                0
              ],
              [
                31.7418309642297,
                -0.8140600737350827,
                0
              ]
            ]
          ]
        },
        "properties": {
          "FID": 219,
          "NAME": "350000_-90000",
          "name": "Tileset",
          "type": "tileset"
        }
      }
    ]
}

const App = () => {
  const [lat, setLat] = useState(0.049928);
  const [lng, setLng] = useState(32.476534);
  const [showLegend, setShowLegend] = useState(false);
  const [showLayerToggle, setShowLayerToggle] = useState(false);
  const [showSearch, setShowSearch] = useState(false);
  const [showReview, setShowReview] = useState(false);
  const [showInfo, setShowInfo] = useState(false);
  const [showAboutModal, setShowAboutModal] = useState(false);
  const [animalMarkersState, setAnimalMarkersState] = useState<AnimalMarker[]>([]);

  const [selectedFeature, setSelectedFeature] = useState<Feature<Geometry, GeoJsonProperties> | null>(null);

  const [isMapClickMode, setIsMapClickMode] = useState(false);

  const [activeSection, setActiveSection] = useState<string | null>(null);

  const [activeLayers, setActiveLayers] = 
  useState<string[]>([
    "Forest", 
    "Beach", "Buildings", 
    "Queen Elizabeth Exhibit", 
    "Farm", "Kidepo", "Lake Mburo", 
    "Lake Victoria", "Parking", "Play Area", "Tileset", "Reviews"]); 
  const [previousLayers, setPreviousLayers] = useState<string[]>([]);
  
  const [showImageLayer, setShowImageLayer] = useState(false);
  const [showCameraMarkers, setShowCameraMarkers] = useState(true);

  const [isLoading, setIsLoading] = useState(false);

  const libraries = useMemo(() => ["places"], []);

  const [formData, setFormData] = useState({
    date: '',
    comments: '',
    rating: '',
    issues: '',
    location: '',
  });
  const [reviews, setReviews] = useState<Review[]>([]);
  const { isLoaded } = useLoadScript({
    googleMapsApiKey: process.env.NEXT_PUBLIC_GOOGLE_MAPS_KEY as string,
    libraries: libraries as any,
  });

  const toggleModal = () => {
    setShowAboutModal(!showAboutModal);
  };

  const onEachFeature = (feature: Feature<Geometry, GeoJsonProperties>, layer: L.Layer) => {
    if (feature.properties && feature.properties.name) {
      layer.bindPopup(`<b>${feature.properties.name}</b>`);
    }

    layer.on('click', (event: L.LeafletMouseEvent) => {
      if (true) {
    
        event.originalEvent.stopPropagation(); 
        const { latlng } = event;
        setLat(latlng.lat);
        setLng(latlng.lng);
        setFormData(prev => ({ ...prev, location: `${latlng.lat}, ${latlng.lng}` }));
        setIsMapClickMode(false); // Optionally disable map click mode after setting the location
      } else {
        // Feature-specific logic if isMapClickMode is not enabled
      }
    });
  };
  
  const handleLayerToggle = (layer: string) => {
    setActiveLayers((prevLayers) =>
      prevLayers.includes(layer)
        ? prevLayers.filter((l) => l !== layer)
        : [...prevLayers, layer]
    );
  };

  const handleSelectionChange = (event: React.ChangeEvent<HTMLSelectElement>) => {
    const selected = event.target.value as keyof typeof parkLocations;

    if (parkLocations[selected]) {
      const { lat, lng } = parkLocations[selected];
      const feature = geojsonData.features.find((f: Feature) => f.properties?.name === selected);
      if (feature) {
        setSelectedFeature(feature);
      }
      setLat(lat);
      setLng(lng);
      setAnimalMarkersState(animalMarkers[selected] || []);
    }
  };

  const handleChange = (e: React.SyntheticEvent<any>) => {
    const target = e.target as (HTMLInputElement | HTMLSelectElement);
    setFormData({ ...formData, [target.name]: target.value });
  };

  const handleSubmit = async (e: FormEvent<HTMLFormElement>) => {
    e.preventDefault();
    setIsLoading(true); // Show loader

    try {
      const res = await createReview(formData);
      const {status, payload} = res;
      if (status) {
        setReviews([...reviews, {...payload, img: "/img/review.PNG"}]);
      }
      setFormData({ date: '', comments: '', rating: '', issues: '', location: '' });
    } catch (error) {
      console.error('Error creating review:', error);
    } finally {
      setIsLoading(false);
    }
  };

  useEffect(() => {
    const getReviews = async () => {
      setIsLoading(true); 
      try {
        const res = await fetchReviews();
        console.log("res", res);
        const {status, payload} = res;
        if (status) {
          const reviewsWithCameraIcon = payload.map((r: Review) => ({...r, img: "/img/review.PNG"})); 
          setReviews(reviewsWithCameraIcon);
        }
      } catch (error) {
        console.error('Error fetching reviews:', error);
      } finally {
        setIsLoading(false); 
      }
    };

    getReviews();
  }, []);
  
  const MapUpdater = () => {
    const map = useMap();

    useEffect(() => {
      if (map) {
        // Add your custom controls
        const currentLocationControl = new CurrentLocationControl({ position: 'topleft' });
        const homeControl = new HomeControl({ position: 'topleft' });
  
        map.addControl(currentLocationControl);
        map.addControl(homeControl);
  
        return () => {
          map.removeControl(currentLocationControl);
          map.removeControl(homeControl);
        };
      }
    }, [map]);

    useEffect(() => {
      if (map && selectedFeature) {
        const bounds = L.geoJSON(selectedFeature).getBounds();
        map.fitBounds(bounds);
      }
    }, [selectedFeature, map]);

    useEffect(() => {
      map.setView([lat, lng], map.getZoom());
    }, [lat, lng, map]);

    useEffect(() => {
      const handleClick = (event: L.LeafletMouseEvent) => {
        if (isMapClickMode) {
          const { latlng } = event;
          setLat(latlng.lat);
          setLng(latlng.lng);
          setFormData(prev => ({ ...prev, location: `${latlng.lat}, ${latlng.lng}` }));
          setIsMapClickMode(false);
        }
      };

      map.on('click', handleClick);
      return () => {
        map.off('click', handleClick);
      };
    }, [isMapClickMode, map]);

    return null;
  };

  const handleAddressSelect = useCallback((address: string) => {
    getGeocode({ address }).then((results) => {
      const { lat, lng } = getLatLng(results[0]);
      setLat(lat);
      setLng(lng);
    });
  }, []);


  const handleGetLocation = () => {
    alert('Getting current location');
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(
        (position) => {
          const { latitude, longitude } = position.coords;
          setLat(latitude);
          setLng(longitude);
          setFormData(prev => ({ ...prev, location: `${latitude}, ${longitude}` }));
        },
        () => {
          alert('Unable to retrieve your location.');
        }
      );
    } else {
      alert('Geolocation is not supported by this browser.');
    }
  };

  const enableMapClickMode = () => {
    alert("Click a location on the map");
    setIsMapClickMode(true);
  };

  const handleSectionToggle = (section: string) => {
    setActiveSection(activeSection === section ? null : section);
  };
  
  const createCustomIcon = (imgUrl: string | undefined) => {
    if (imgUrl) {
      return L.icon({
        iconUrl: imgUrl,
        iconSize: [30, 30], // Adjust the size as needed
        iconAnchor: [10, 10], // Anchor the icon at the center-bottom
        popupAnchor: [0, -40] // Adjust popup position
      });
    }
  };

  const handleCheckboxChange = (e: ChangeEvent<HTMLInputElement>) => {
    const { checked } = e.target;
    setShowImageLayer(checked);

    if (checked) {
      setPreviousLayers(activeLayers); // Save the current layers before unchecking them
      setActiveLayers(["imageLayer"]); // Only show the image layer
    } else {
      setActiveLayers(previousLayers); // Restore the previously active layers
    }
  };

  const style = (feature: Feature<Geometry, GeoJsonProperties> | undefined) => {
    if (feature?.properties) {
      switch (feature.properties.name) {
        case 'Forest':
          return { color: 'hsla(102, 64%, 23%, 0.8)', fillColor: 'hsla(102, 64%, 23%, 0.8)', fillOpacity: 1 };
        case "Beach":
          return { color: 'hsla(80, 49%, 41%, 0.39)', fillColor: 'hsla(80, 49%, 41%, 0.39)', fillOpacity: 1 };
        case "Buildings":
          return { color: 'hsl(40, 85%, 35%)', fillColor: 'hsl(40, 85%, 35%)', fillOpacity: 1 };
        case "Queen Elizabeth Exhibit":
          return { color: 'hsl(164, 69%, 30%)', fillColor: 'hsl(164, 69%, 30%)', fillOpacity: 0.5 };
        case "Farm":
          return { color: 'hsl(40, 85%, 35%)', fillColor: 'hsl(40, 85%, 35%)', fillOpacity: 0.5 };
        case "Kidepo":
            return { color: 'hsl(164, 69%, 30%)', fillColor: 'hsl(164, 69%, 30%)', fillOpacity: 0.5 };
        case "Lake Mburo":
            return { color: 'pink', fillColor: 'pink', fillOpacity: 0.5 };
        case "Lake Victoria":
            return { color: 'hsl(196, 74%, 66%)', fillColor: 'hsl(196, 74%, 66%)', fillOpacity: 1 };
        case "Parking":
            return { color: 'hsla(66, 78%, 7%, 0.5)', fillColor: 'hsla(66, 78%, 7%, 0.5)', fillOpacity: 0.5 };
        case "Play Area":
            return { color: 'hsla(74, 42%, 40%, 0.5)', fillColor: 'hsla(74, 42%, 40%, 0.5)', fillOpacity: 0.5 };
        case "Tileset":
            return { color: 'hsl(0, 71%, 85%)', fillColor: 'hsl(0, 71%, 85%)', fillOpacity: 0.5 };

        default:
          return { color: 'gray', fillColor: 'lightgray', fillOpacity: 0.5 };
      }
    }
    return { color: 'gray', fillColor: 'lightgray', fillOpacity: 0.5 };
  };


  const layers = [
    { name: 'Forest', icon: <FaTree className='mx-1' />, id: 'forest' },
    { name: 'Beach', icon: <FaMapSigns className='mx-1' />, id: 'beach' },
    { name: 'Buildings', icon: <FaBuilding className='mx-1' />, id: 'buildings' },
    { name: 'Queen Elizabeth Exhibit', icon: <FaPaw className='mx-1' />, id: 'queen-elizabeth' },
    { name: 'Farm', icon: <FaTractor className='mx-1' />, id: 'farm' },
    { name: 'Kidepo', icon: <FaFlag className='mx-1' />, id: 'kidepo' },
    { name: 'Lake Mburo', icon: <FaWater className='mx-1' />, id: 'lake-mburo' },
    { name: 'Lake Victoria', icon: <FaWater className='mx-1' />, id: 'lake-victoria' },
    { name: 'Parking', icon: <FaParking className='mx-1' />, id: 'parking' },
    { name: 'Play Area', icon: <FaRunning className='mx-1' />, id: 'play-area' },
    { name: 'Tileset', icon: <FaLayerGroup className='mx-1' />, id: 'tileset' },
  ];

  

  if (!isLoaded) {
    return <Loader />;
  }

  return (
    <div className='container'>
      {/* Loader */}
      {isLoading && <Loader />}

      {/* Navbar */}
      <nav id="navbar" className="navbar navbar-expand-md navbar-dark blue fixed-top justify-content-between">
            <div className="container flex">
                <a className="navbar-brand" href="https://uwec.ug/" target="_blank" rel="noopener noreferrer">
                    <FaTree /> UWEC
                </a>
                <button className="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
                    <span
                        className="navbar-toggler-icon"></span>
                </button>
                <div className="collapse navbar-collapse ml-auto justify-content-end" id="navbarResponsive">   
                    <ul className="navbar-nav ml-auto">
                        <li className="nav-item">
                            <button className="nav-link btn btn-link" onClick={toggleModal}>About</button>
                        </li>
                    </ul>
                </div>
            </div>
      </nav>

      {/* About Modal */}
      {showAboutModal && (
        <div className="modal show" style={{ display: 'block' }} tabIndex={-1} role="dialog" aria-labelledby="aboutModalLabel" aria-hidden="true">
          <div className="modal-dialog modal-dialog-centered" role="document">
            <div className="modal-content">
              <div className="modal-header flex">
                <h5 className="modal-title" id="aboutModalLabel">About the Map</h5>
                {/* <button type="button" className="close justify-content-end" onClick={toggleModal} aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button> */}
              </div>
              <div className="modal-body">
                <p>This map was created by Jimmy for  Web Map Programming Master&rsquo;s degree program.</p>
                <hr />
                <h5>Data Sources</h5>
                <p>UWEC: <a href='https://uwec.ug/product/chimpanzee-close-up/' target="_blank" rel="noopener noreferrer">UWEC</a></p>
                <p>GEOSON <a href='https://api.mapbox.com/styles/v1/aleku399/clz70zcqi00r501pfh862a69g.html?title=view&access_token=pk.eyJ1IjoiYWxla3UzOTkiLCJhIjoiY2praDBkbXpzMDlxNjNrcDBqNGUwc3kzeSJ9.Jfwtzm5tQfXFiWBjIQUvUA&zoomwheel=true&fresh=true#15.41/0.051655/32.477589' target="_blank" rel="noopener noreferrer">GEOSON</a></p>
                <p>Historic places adapted from: <a href="https://api.mapbox.com/styles/v1/aleku399/clz70zcqi00r501pfh862a69g.html?title=view&access_token=pk.eyJ1IjoiYWxla3UzOTkiLCJhIjoiY2praDBkbXpzMDlxNjNrcDBqNGUwc3kzeSJ9.Jfwtzm5tQfXFiWBjIQUvUA&zoomwheel=true&fresh=true#15.41/0.051655/32.477589" target="_blank" rel="noopener noreferrer">UWEC&rsquo;s  Zoo Historical Sites</a></p>
              </div>
              <div className="modal-footer">
                <button type="button" className="btn btn-primary" onClick={toggleModal}>Close</button>
              </div>
            </div>
          </div>
        </div>
      )}

      {/* Map */}
      <div  id="map">
        <MapContainer 
          center={[lat, lng]} 
          zoom={16} 
          style={{ height: '100vh', width: '100%' }}
      
        >
          {/* url="https://api.mapbox.com/styles/v1/aleku399/clzl2g938002j01r0erdd0l3r/tiles/256/{z}/{x}/{y}@2x?access_token=pk.eyJ1IjoiYWxla3UzOTkiLCJhIjoiY2praDBkbXpzMDlxNjNrcDBqNGUwc3kzeSJ9.Jfwtzm5tQfXFiWBjIQUvUA */}
          <TileLayer
            url="https://api.mapbox.com/styles/v1/aleku399/clzl2g938002j01r0erdd0l3r/tiles/256/{z}/{x}/{y}@2x?access_token=pk.eyJ1IjoiYWxla3UzOTkiLCJhIjoiY2praDBkbXpzMDlxNjNrcDBqNGUwc3kzeSJ9.Jfwtzm5tQfXFiWBjIQUvUA"
            attribution='&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
          />
          {showImageLayer && (
            <ImageOverlay
              url="/Map1.png"
              bounds={[[0.055789, 32.472825], [0.049798, 32.480078]]}
            />
          )}
    
          {activeLayers.map(layer => (
              <GeoJSON
                key={layer}
                data={{
                  ...geojsonData,
                  features: geojsonData.features.filter((feature: Feature<Geometry, GeoJsonProperties>) =>
                    feature?.properties?.name === layer
                  )
                } as GeoJsonObject}
                onEachFeature={onEachFeature}
                style={style as any}
              />
            ))}
              {animalMarkersState.map((marker, index) => (
                <Marker key={index} position={[marker.lat, marker.lng]} icon={createCustomIcon(marker.img)}>
                  <Popup>{marker.type}</Popup>
                </Marker>
              ))}
               {showCameraMarkers &&  reviews.map((review, index) => (
                  <Marker
                    key={index}
                    position={[parseFloat(review.location.split(',')[0]), parseFloat(review.location.split(',')[1])]}
                    icon={createCustomIcon(review.img)}
                  >
                    <Popup>
                      <div>
                        <strong>Comments:</strong> {review.comments}<br />
                        <strong>Rating:</strong> {review.rating}<br />
                        <strong>Date:</strong> {review.date}
                      </div>
                    </Popup>
                  </Marker>
                ))}
            <MapUpdater />
        </MapContainer>
      </div>
     

      {/* Sidebar */}
      <div id="sidebar">
        {/* Park info */}
        <button
          id="park-info"
          type="button"
          className="btn btn-primary"
          onClick={() => handleSectionToggle('info')}
        >
          <FaInfoCircle />
        </button>
        <div
          className={`collapse ${activeSection === 'info' ? 'show' : ''}`}
          id="info-collapse"
        >
          <div>
            <h4 className='text-red-100'>About the Uganda Wildlife Education Center</h4>
            <p>The Uganda Wildlife Education Center (UWEC) is a premier wildlife education facility located in Entebbe, Uganda. The center is dedicated to the conservation and education of Uganda’s wildlife and aims to provide visitors with an understanding of the country’s diverse fauna. UWEC features a variety of wildlife exhibits, including African lions, giraffes, and hippos, as well as educational programs about conservation efforts.</p>
            <a href="https://www.uwec.org" target="_blank" rel="noopener noreferrer">Learn More About UWEC</a>
          </div>
        </div>


        {/* Legend */}
        <button
          id="leg"
          type="button"
          className="btn btn-primary"
          onClick={() => handleSectionToggle('legend')}
        >
          <FaClipboardList />
        </button>
        <div
          className={`collapse ${activeSection === 'legend' ? 'show' : ''}`}
          id="legend"
        >
          <div id="card">
            <h4>Legend:</h4>
            <div id="legend">
              <div id="thmb">
                <img id="thumbnails" height="35px" width="35px" src="img/boundary.PNG" alt="Park Boundary"/> Park Boundary<br />
                <img id="thumbnails" height="35px" width="35px" src="img/review.PNG" alt="Reviews"/> Reviews<br />
                <img id="thumbnails" height="35px" width="35px" src="img/historical.PNG" alt="Historical Places"/>Queen Elizabeth<br />
                <img id="thumbnails" height="35px" width="35px" src="img/poi.PNG" alt="Points of Interest"/>Lakes<br />
              </div>
            </div>
          </div>
        </div>

        {/* Layer Toggle */}
        <button
        id="toggle-button"
        type="button"
        className="btn btn-primary"
        onClick={() => handleSectionToggle('layer-toggle')}
      >
        <FaLayerGroup />
      </button>
      <div
        className={`collapse ${activeSection === 'layer-toggle' ? 'show' : ''}`}
        id="toggle-collapse"
      >
        <h5>Layers</h5>
        <ul>
          {layers.map((layer) => (
            <li key={layer.name} className="my-2">
              <label className="flex items-center">
                <input
                  type="checkbox"
                  checked={activeLayers.includes(layer.name)}
                  onChange={() => handleLayerToggle(layer.name)}
                  className="mr-2"
                />
                <span className="flex items-center">
                  {layer.icon} {layer.name}
                </span>
              </label>
            </li>
          ))}
           <li className="my-2">
              <label className="flex items-center">
                <input
                  type="checkbox"
                  checked={showCameraMarkers}
                  onChange={() => setShowCameraMarkers(!showCameraMarkers)}
                />
                <span className="flex items-center">
                <FaRegCommentDots /> {"Reviews"}
                </span>
              </label>
            </li>
         
           <div>
              <input
                type="checkbox"
                checked={showImageLayer}
                onChange={handleCheckboxChange}
              />
              Show Image Layer
            </div>
        </ul>
      </div>

        {/* Search */}
        <button
          id="search-button"
          type="button"
          className="btn btn-primary"
          onClick={() => handleSectionToggle('search')}
        >
          <FaSearch />
        </button>
        <div
          className={`collapse ${activeSection === 'search' ? 'show' : ''}`}
          id="search-collapse"
        >
          <h5>Search</h5>
          <select onChange={handleSelectionChange} className="form-select">
            <option value="">Select a park or feature...</option>
            {Object.keys(parkLocations).map((option) => (
              <option key={option} value={option}>{option}</option>
            ))}
          </select>
          <PlacesAutocomplete onAddressSelect={handleAddressSelect}  />
        </div>

        {/* Submit a Review */}
        <button 
          id="review" 
          type="button" 
          className="btn btn-primary" 
          onClick={() =>  { 
            handleSectionToggle('review')
            setFormData({...formData, location: ""})
          }}
        >
          <FaRegCommentDots />
        </button>
        <div 
          className={`collapse ${activeSection === 'review' ? 'show' : ''}`}
          id="review-collapse"
        >
        <form onSubmit={handleSubmit} className="p-3 ">
          <h4 className="mb-3">Submit a Review:</h4>
          <p>(*Required fields)</p>
          
          <div className="form-group mb-3">
            <label htmlFor="date"><strong>Date of Visit*:</strong></label>
            <input 
              type="date" 
              id="date" 
              name="date" 
              className="form-control" 
              value={formData.date} 
              onChange={handleChange} 
              required 
            />
          </div>
          
          <div className="form-group mb-3">
            <label htmlFor="comments"><strong>Comments*:</strong></label>
            <input 
              type="text" 
              id="comments" 
              name="comments" 
              className="form-control" 
              value={formData.comments} 
              onChange={handleChange} 
              required 
            />
          </div>
          
          <div className="form-group mb-3">
            <label htmlFor="rating"><strong>Rate your experience*:</strong><br />(1 = worst, 5 = best)</label>
            <select 
              id="rating" 
              name="rating" 
              className="form-control" 
              value={formData.rating} 
              onChange={handleChange} 
              required
            >
              <option value="">Rating</option>
              <option value="1">1</option>
              <option value="2">2</option>
              <option value="3">3</option>
              <option value="4">4</option>
              <option value="5">5</option>
            </select>
          </div>
          
          <div className="form-group mb-3">
            <label htmlFor="issues"><strong>Report an issue:</strong></label>
            <input 
              type="text" 
              id="issues" 
              name="issues" 
              className="form-control" 
              value={formData.issues} 
              onChange={handleChange} 
            />
          </div>
          
          <div className="form-group mb-3">
            <label htmlFor="location"><strong>Location*:</strong><br />(Enter a lat/lon coordinate)</label>
            <div className="d-flex flex-column">
              <button type="button" className="btn btn-primary mb-2" onClick={handleGetLocation}>
                Use Location
              </button>
              <button type="button" className="btn btn-secondary" onClick={enableMapClickMode}>
                Use Map
              </button>
            </div>
            <input 
              type="text" 
              id="location" 
              name="location" 
              className="form-control mt-2" 
              value={formData.location} 
              onChange={handleChange} 
              required 
            />
          </div>
          
          <input type="submit" value="Submit" className="btn btn-success mt-1" />
        </form>

        </div>
      </div>
    </div>
  );
};

export default App;
